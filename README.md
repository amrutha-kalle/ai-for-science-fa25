# Enhanced Graph–Text Diffusion for Crystal Structure Generation and Property Prediction

### Project Repository for CS291A: AI for Science Fall 2025

Sathvika Anand, Ofir Dvir, Amrutha Kalle, Joseph Ng



#### Directory Structure
```
├── CrystaLLM                       - Source code for CrystaLLM
├── cgcnn                           - Source code for CGCNN
├── chemeleon                       - Source code for Chemeleon
│   ├── data 
│   │   └── my-ds                   - Dataset used by our pipeline
│   └── logs
│       └── my-ds
│           └── Chemeleon_v0.1.1    - Directory containing our trained checkpoints
└── src                             - Scripts for validation and evaluation
```

#### Running Inference
First, follow the setup steps for CrystaLLM here: https://github.com/lantunes/CrystaLLM. To generate the initial prompts for CrystaLLM, you will need a set of chemical compositions. These can be pulled from whatever source, in our paper we use 500 chemicals from the MP database. Once you have the chemical compositions, you can follow the steps in https://github.com/lantunes/CrystaLLM?tab=readme-ov-file#evaluating-generated-cif-files to create prompts, and then run CrystaLLM to get 500 generated CIFs. 

You will need to read the CIFs into a CSV format, where the string content of each CIF is in a column named ['cif']. 

To run inference: 
```
python3 chemeleon/analyze_cif_with_chemeleon.py --csv path-to-cifs.csv --output-dir output-dir --checkpoint diffusion-model.cpkt --clip-checkpoint clip-model.cpkt
```
You can find the checkpoints for both clip and diffusion models trained with and without gep in chemeleon/logs/my-ds/Chemeleon_v0.1.1
This command will create 6 files for each input CIF: two samples each for the three modes, cif, text, and cif + text. You can choose specific modes via command line argument. It will also do some pairwise comparisons of CIF contents, and produce a report of the findings.
Here is the structure of the files created by this command: 
```
<output_dir>/
│
├── final_results.json
├── compositions.json
├── comparisons.pkl
├── REPORT.txt
│
├── intermediate_results.json     (written every 5 CIFs processed)
│
└── generated_cifs/
    ├── <material_id_1>/
    │   ├── text_sample0.cif
    │   ├── text_sample1.cif
    │   ├── cif_sample0.cif
    │   ├── cif_sample1.cif
    │   ├── text+cif_sample0.cif
    │   └── text+cif_sample1.cif
    │
    ├── <material_id_2>/
    │   ├── text_sample0.cif
    │   ├── text_sample1.cif
    │   ├── cif_sample0.cif
    │   ├── cif_sample1.cif
    │   ├── text+cif_sample0.cif
    │   └── text+cif_sample1.cif
    │
    └── ... one subdirectory per processed CIF entry ...
```

#### CIF Validation
To validate CIFS generated by Chemelon, use the command
```bash
python src/validate_cifs.py -d <cif_directory> -o <output_csv>
```
The output csv stores the four criteria used to determine validity as well as information about electronegativities.


